<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum scale =1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />

    <title>Babylon.js sample code</title>
    <!-- Babylon.js -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.js"></script>
    <script src="https://www.babylonjs.com/hand.minified-1.2.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/oimo.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="tween.js"></script>

    <script src="velocity.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.0/TweenMax.min.js"></script>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        #header {
            font-family: Open Sans;
            font-size: 45px;
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
            background-color: #FFFFFF;
            color: white;
        }

        #Triangle {
            font-family: Open Sans;
            font-size: 45px;
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
            background-color: #FFFFFF;
            color: white;
        }

        #over {
            width: 100%;
            height: 100%;
            background-color: black;
            color: white;
        }

        #button {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Restart {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Pause {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Play {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Pult {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #button-right {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Pause {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }

        #Play {
            position: absolute;
            width: 100%;
            height: 0px;
            z-index: 1;
            opacity: 1;
        }
    </style>
    <span id="Triangle"><img style = "margin:1%" width = "220" height = "180" src = "files/triangle.png"> </span>
    <span id="Pult" style=" display:none;"><img align = "right" style = "margin-top:16%;" width = "224" height = "460"  src = "files/Pult1.png"> </span>
    <span id="Restart" style=" display:none;"><img style = "margin-top:21%;margin-right:4.3%; " width = "80" height = "80" align = "right" src = "files/Restart.png"> </span>
    <span id="Pause" style=" display:none;"><img style = "margin-top:27%;margin-right:4.3%; " width = "80" height = "80" align = "right" src = "files/Pause.png"> </span>
    <span id="Play" style=" display:none;"><img style = "margin-top:33%;margin-right:4.3%; " width = "80" height = "80" align = "right" src = "files/Play.png"> </span>
    <span id="header"><img id = "firstball" style = "margin-top:8.85%; margin-left:1.6%" width = "40px" height = "40px" src = "files/1.png"><img id = "secondball" style = "margin-top:8.8%;" width = "40px" height = "40px" src = "files/2.png"><img id = "thirdball" style = "margin-top:8.8%;" width = "40px" height = "40px" src = "files/3.png"><img id = "fourthball" style = "margin-top:8.8%;display:none" width = "40px" height = "40px" src = "files/4.png"><img id = "fifthball" style = "margin-top:8.8%;display:none" width = "40px" height = "40px" src = "files/5.png"></span>
    <span id="button-right"><img onclick="pullview()"  style = "margin-top:27%;" align = "right" height = "100px" width = "60px" src =  "files/button-right.png"></span>
    <div id="over"><img style="width:100%;height:100%" src="Over.jpg"> </div>

    <body>

        <canvas id="renderCanvas"></canvas>

        <script>
            document.getElementById('over').style.display = 'none';

            var test = 0;
           

            function pullview() {
                if (test % 2 == 0) {
                    test++;
                    $('#Pause').fadeOut(500);
                    $('#Pult').fadeOut(500);
                    $('#Play').fadeOut(500);
                    $('#Restart').fadeOut(500);
                } else {
                    test++;
                    $('#Pause').fadeIn(500);
                    $('#Pult').fadeIn(500);
                    $('#Play').fadeIn(500);
                    $('#Restart').fadeIn(500);
                }

            }

            var checkport = 0;
            var open22 = 0;
            var open11 = 0;
            var check2 = 0;
            var check1 = 0;
            var lifes = 3;
            var life1 = 0;
            var death = 0;
            var Music1 = 0;
            var Music2 = 0;
            var Music3 = 0;
            var Portalzero = 0;
            var Portalfisrt = 0;
            var canvas = document.getElementById("renderCanvas");
            var engine = new BABYLON.Engine(canvas, true);
            var scene = new BABYLON.Scene(engine);
            BABYLON.SceneLoader.Load("files/", "scene.babylon", engine, function(scene) {
                scene.executeWhenReady(function() {
                    //Sounds

                    var watersound1 = new Audio('water.mp3'); //Музыка в конце
                    var watersound2 = new Audio('water2.mp3'); //Музыка в конце

                    //Textures
                    var water = new BABYLON.StandardMaterial("texture", scene);
                    water.diffuseTexture = new BABYLON.Texture("files/water1.png", scene);
                    water.emissiveTexture = new BABYLON.Texture("files/water1.png", scene);
                    water.emissiveTexture.vOffset = 0.1; //Vertical offset of 10%
                    water.emissiveTexture.uOffset = 0.4; //Horizontal offset of 40%
                    water.emissiveColor = new BABYLON.Color3(.1, .1, .1);

                    water.ambientTexture = new BABYLON.Texture("files/water1.png", scene);
                    water.ambientTexture.vOffset = 0.1; //Vertical offset of 10%
                    water.ambientTexture.uOffset = 0.4; //Horizontal offset of 40%

                    water.specularTexture = new BABYLON.Texture("files/water1.png", scene);
                    water.specularTexture.vOffset = 0.1; //Vertical offset of 10%
                    water.specularTexture.uOffset = 0.4; //Horizontal offset of 40%

                    water.specularPower = 9999999;

                    //Ground
                    var ground = BABYLON.Mesh.CreateGround("ground1", 1000, 1000, 1000, scene);
                    ground.visibility = false;

                    //Sphere-play
                    var sphere = BABYLON.Mesh.CreateSphere("sphere1",105,1.2,scene);
                    // sphere.attachControl(canvas, false);

                    sphere.scaling.x = 0.55;
                    sphere.scaling.y = 0.55; //Размеры сферы
                    sphere.scaling.z = 0.55;

                    sphere.position.x = scene.getMeshByName("Sphere").position.x;
                    sphere.position.y = scene.getMeshByName("Sphere").position.y + 1;
                    sphere.position.z = scene.getMeshByName("Sphere").position.z;

                    //     sphere.position.x=scene.getMeshByName("Portal2").position.x+0.7;
                    //Finalpos  sphere.position.y=scene.getMeshByName("Portal2").position.y+1;
                    //   sphere.position.z=scene.getMeshByName("Portal2").position.z-1;
                    //Sphere-life
					
					//Небо в движении
					
					
					
					var light0 = new BABYLON.DirectionalLight("Dir0", new BABYLON.Vector3(0, -1, 0), scene);
light0.diffuse = new BABYLON.Color3(221/225,230/255,240/255);
light0.specular = new BABYLON.Color3(1, 1, 1);

					
		            var a = 1;
					var scale = 12;
					var plane = BABYLON.Mesh.CreatePlane("plane", 520, scene);
					var materialPlane = new BABYLON.StandardMaterial("texturePlane", scene);
					materialPlane.diffuseTexture = new BABYLON.Texture(" sky/lol.jpg", scene);
					//materialPlane.opacityTexture = new BABYLON.Texture(" sky/lol.jpg", scene);
				//	materialPlane.diffuseTexture.hasAlpha = true;
				//	materialPlane.opacityTexture.getAlphaFromRGB = true;
                    materialPlane.specularPower = 9999999;
					// materialPlane.emissiveTexture = new BABYLON.Texture("sky/lol.jpg", scene);
                  //   materialPlane.emissiveTexture.vOffset = 0.1; //Vertical offset of 10%
                   //  materialPlane.emissiveTexture.uOffset = 0.4; //Horizontal offset of 40%
                    // materialPlane.emissiveColor = new BABYLON.Color3(.1, .1, .1);
					 
				//	 materialPlane.ambientTexture = new BABYLON.Texture(" sky/lol.jpg", scene);
			
					function offset(){
					plane.position.y = -5;
					plane.rotation.x = Math.PI / 2;
					materialPlane.diffuseTexture.uScale = scale-1;
					materialPlane.diffuseTexture.vScale = scale-1;
					if(!(scale % 2)) {
						materialPlane.diffuseTexture.uOffset = a / scale;
						materialPlane.diffuseTexture.vOffset = a / scale;
					}
					materialPlane.backFaceCulling = false;
				   plane.material = materialPlane;
				   a=a+0.0005;
				 //  console.log("a");
				}

				
					setInterval(offset, 1);

                    var life = BABYLON.Mesh.CreateSphere("sphere1,12,12,scene");

                    life.scaling.x = 0.5;
                    life.scaling.y = 0.5; //Размеры сферы
                    life.scaling.z = 0.5;

                    life.position.x = -10.8;
                    life.position.y = 5.682;
                    life.position.z = 14;

                    var materiallife = new BABYLON.StandardMaterial("texture", scene);
                    materiallife.diffuseTexture = new BABYLON.Texture("files/Life.png", scene);

                    var materialbulb = new BABYLON.StandardMaterial("texture", scene);
                    materialbulb.diffuseTexture = new BABYLON.Texture("files/Bulb.png", scene);
                    materiallife.alpha = 0.5;
                    life.material = materiallife;
                    //cubes-open

                    var open1 = BABYLON.Mesh.CreateBox("open1,12,12,scene");

                    open1.position.x = -4.8;
                    open1.position.y = 5.4;
                    open1.position.z = 13.126;

                    var sphereopen = BABYLON.Mesh.CreateSphere("sphereopen1,12,12,scene");


                    sphereopen.scaling.x = 0.6;
                    sphereopen.scaling.y = 0.6; //Размеры сферы
                    sphereopen.scaling.z = 0.6;

                    sphereopen.position.x = -4.8;
                    sphereopen.position.y = 5.682;
                    sphereopen.position.z = 13.126;

                    open1.scaling.x = 0.6;
                    open1.scaling.y = 0.01; //Размеры сферы
                    open1.scaling.z = 0.6;

                    var sphereopen2 = BABYLON.Mesh.CreateSphere("sphereopen1,12,12,scene");

                    sphereopen2.scaling.x = 0.6;
                    sphereopen2.scaling.y = 0.6; //Размеры сферы
                    sphereopen2.scaling.z = 0.6;

                    sphereopen2.position.x = -4.8;
                    sphereopen2.position.y = 5.682;
                    sphereopen2.position.z = 10.245;

                    open1.scaling.x = 0.6;
                    open1.scaling.y = 0.01; //Размеры сферы
                    open1.scaling.z = 0.6;
                    sphereopen2.material = water;
                    sphereopen.material = water;
                    var open2 = BABYLON.Mesh.CreateBox("open2,12,12,scene");

                    var yellow = new BABYLON.StandardMaterial("texture", scene);
                    yellow.diffuseTexture = new BABYLON.Texture("files/yellow.jpg", scene);
                    yellow.diffuseTexture = new BABYLON.Texture("files/yellow.jpg", scene); //Дерево      
                    yellow.emissiveTexture = new BABYLON.Texture("files/yellow.jpg", scene);
                    yellow.emissiveTexture.vOffset = 0.1; //Vertical offset of 10%
                    yellow.emissiveTexture.uOffset = 0.4; //Horizontal offset of 40%
                    yellow.emissiveColor = new BABYLON.Color3(.1, .1, .1);

                    yellow.ambientTexture = new BABYLON.Texture("files/yellow.jpg", scene);
                    yellow.ambientTexture.vOffset = 0.1; //Vertical offset of 10%
                    yellow.ambientTexture.uOffset = 0.4; //Horizontal offset of 40%

                    yellow.specularTexture = new BABYLON.Texture("files/yellow.jpg", scene);
                    yellow.specularTexture.vOffset = 0.1; //Vertical offset of 10%
                    yellow.specularTexture.uOffset = 0.4; //Horizontal offset of 40%

                    yellow.specularPower = 1;
                    open1.material = yellow;
                    open2.material = yellow;
                    open2.position.x = -4.8;
                    open2.position.y = 5.4;
                    open2.position.z = 10.245;

                    open2.scaling.x = 0.6;
                    open2.scaling.y = 0.01; //Размеры сферы
                    open2.scaling.z = 0.6;



                    var materialSpherewood = new BABYLON.StandardMaterial("texture", scene);
                    materialSpherewood.diffuseTexture = new BABYLON.Texture("files/Ball_Wood.jpg", scene); //Дерево      
                    materialSpherewood.emissiveTexture = new BABYLON.Texture("files/Ball_Wood.jpg", scene);
                    materialSpherewood.emissiveTexture.vOffset = 0.1; //Vertical offset of 10%
                    materialSpherewood.emissiveTexture.uOffset = 0.4; //Horizontal offset of 40%
                    materialSpherewood.emissiveColor = new BABYLON.Color3(.1, .1, .1);

                    materialSpherewood.ambientTexture = new BABYLON.Texture("files/Ball_Wood.jpg", scene);
                    materialSpherewood.ambientTexture.vOffset = 0.1; //Vertical offset of 10%
                    materialSpherewood.ambientTexture.uOffset = 0.4; //Horizontal offset of 40%

                    materialSpherewood.specularTexture = new BABYLON.Texture("files/Ball_Wood.jpg", scene);
                    materialSpherewood.specularTexture.vOffset = 0.1; //Vertical offset of 10%
                    materialSpherewood.specularTexture.uOffset = 0.4; //Horizontal offset of 40%

                    materialSpherewood.specularPower = 9999999;




                    var materialSpherestone = new BABYLON.StandardMaterial("texture", scene);
                    materialSpherestone.diffuseTexture = new BABYLON.Texture("files/Ball_Stone.jpg", scene); //Камень

                    var materialSpherepaper = new BABYLON.StandardMaterial("texture", scene);
                    materialSpherepaper.diffuseTexture = new BABYLON.Texture("files/Ball_Paper.jpg", scene); //Бумага

                    sphere.material = materialSpherewood; //Вывод самой текстуры



                    var cubefixer1 = scene.getMeshByName('Cube1').position.z;
                    var cubefixer2 = scene.getMeshByName('Cube2').position.z;
                    var cubefixer3 = scene.getMeshByName('Cube3').position.z;

                    var cuberotatefixer1z = scene.getMeshByName('Cube1').rotate.z;
                    var cuberotatefixer1y = scene.getMeshByName('Cube1').rotate.y;
                    var cuberotatefixer1x = scene.getMeshByName('Cube1').rotate.y;

                    var cuberotatefixer2z = scene.getMeshByName('Cube2').rotate.z;
                    var cuberotatefixer2x = scene.getMeshByName('Cube2').rotate.x;
                    var cuberotatefixer2y = scene.getMeshByName('Cube2').rotate.y;

                    var cuberotatefixer3z = scene.getMeshByName('Cube3').rotate.z;
                    var cuberotatefixer3x = scene.getMeshByName('Cube3').rotate.x;
                    var cuberotatefixer3y = scene.getMeshByName('Cube3').rotate.y;

                    //camera ball

                    //    sphere.position.x=-9;
                    //Final sphere.position.y=6.76;
                    //    sphere.position.z=-7;

                    var camera = scene.activeCamera;
                    camera.maxZ = 1000;
                    camera.position.y = sphere.position.y + 2;
                    camera.position.z = sphere.position.z;
                    camera.position.x = sphere.position.x - 4;

                    //Здесь ЭЛЕМЕНТЫ
                    var Portal1 = scene.getMeshByName("Portal1");
                    var track1 = scene.getMeshByName("track1");
                    var Bridge1 = scene.getMeshByName("Bridge1");
                    var platform1 = scene.getMeshByName("platform1");
                    var road1 = scene.getMeshByName("road1");
                    var Cube = scene.getMeshByName("Cube");

                    var Roadcorn = scene.getMeshByName("Roadcorn");
                    var Final = scene.getMeshByName("Final");
                    var Portal2 = scene.getMeshByName("Portal2");
                    var Stone = scene.getMeshByName("Stone");
                    var Platformroad = scene.getMeshByName("Platformroad");
                    var Cube1 = scene.getMeshByName("Cube1");
                    var Cube2 = scene.getMeshByName("Cube2");
                    var Cube3 = scene.getMeshByName("Cube3");
                    // Create a particle system
                    var particleSystem1 = new BABYLON.ParticleSystem("particles", 2000, scene);

                    //Texture of each particle
                    particleSystem1.particleTexture = new BABYLON.Texture("files/Life.png", scene);

                    // Where the particles come from
                    particleSystem1.emitter = sphere; // the starting object, the emitter
                    particleSystem1.minEmitBox = new BABYLON.Vector3(-1, 0, 0); // Starting all from
                    particleSystem1.maxEmitBox = new BABYLON.Vector3(1, 0, 0); // To...

                    // Colors of all particles
                    particleSystem1.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 1.0);
                    particleSystem1.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 1.0);
                    particleSystem1.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0);

                    // Size of each particle (random between...
                    particleSystem1.minSize = 0.1;
                    particleSystem1.maxSize = 0.3;

                    // Life time of each particle (random between...
                    particleSystem1.minLifeTime = 0.1;


                    // Emission rate
                    particleSystem1.emitRate = 250;

                    // Blend mode : BLENDMODE_ONEONE, or BLENDMODE_STANDARD
                    particleSystem1.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

                    // Set the gravity of all particles
                    particleSystem1.gravity = new BABYLON.Vector3(0, -9.81, 0);

                    // Direction of each particle after it has been emitted
                    particleSystem1.direction1 = new BABYLON.Vector3(-7, 8, 3);
                    particleSystem1.direction2 = new BABYLON.Vector3(7, 8, -3);

                    // Angular speed, in radians
                    particleSystem1.minAngularSpeed = 0;
                    particleSystem1.maxAngularSpeed = Math.PI;

                    // Speed
                    particleSystem1.minEmitPower = 1;
                    particleSystem1.maxEmitPower = 3;
                    particleSystem1.updateSpeed = 0.005;

                    // Start the particle system
                    particleSystem1.start();

                    function Stop() {


                        particleSystem1.stop(); //Остановка
                    }

                    setTimeout(Stop, 3000);

                    var particleSystem2 = new BABYLON.ParticleSystem("particles", 2000, scene);

                    //Texture of each particle
                    particleSystem2.particleTexture = new BABYLON.Texture("files/water.png", scene);

                    // Where the particles come from
                    particleSystem2.emitter = open2; // the starting object, the emitter
                    particleSystem2.minEmitBox = new BABYLON.Vector3(-1, 0, 0); // Starting all from
                    particleSystem2.maxEmitBox = new BABYLON.Vector3(1, 0, 0); // To...

                    // Colors of all particles
                    particleSystem2.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 1.0);
                    particleSystem2.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 1.0);
                    particleSystem2.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0);

                    // Size of each particle (random between...
                    particleSystem2.minSize = 0.1;
                    particleSystem2.maxSize = 0.3;

                    // Life time of each particle (random between...
                    particleSystem2.minLifeTime = 0.1;


                    // Emission rate
                    particleSystem2.emitRate = 250;

                    // Blend mode : BLENDMODE_ONEONE, or BLENDMODE_STANDARD
                    particleSystem2.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

                    // Set the gravity of all particles
                    particleSystem2.gravity = new BABYLON.Vector3(0, -9.81, 0);

                    // Direction of each particle after it has been emitted
                    particleSystem2.direction1 = new BABYLON.Vector3(-7, 8, 3);
                    particleSystem2.direction2 = new BABYLON.Vector3(7, 8, -3);

                    // Angular speed, in radians
                    particleSystem2.minAngularSpeed = 0;
                    particleSystem2.maxAngularSpeed = Math.PI;

                    // Speed
                    particleSystem2.minEmitPower = 1;
                    particleSystem2.maxEmitPower = 3;
                    particleSystem2.updateSpeed = 0.005;


                    var particleSystem3 = new BABYLON.ParticleSystem("particles", 2000, scene);

                    //Texture of each particle
                    particleSystem3.particleTexture = new BABYLON.Texture("files/water.png", scene);

                    // Where the particles come from
                    particleSystem3.emitter = open1; // the starting object, the emitter
                    particleSystem3.minEmitBox = new BABYLON.Vector3(-1, 0, 0); // Starting all from
                    particleSystem3.maxEmitBox = new BABYLON.Vector3(1, 0, 0); // To...

                    // Colors of all particles
                    particleSystem3.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 1.0);
                    particleSystem3.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 1.0);
                    particleSystem3.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0);

                    // Size of each particle (random between...
                    particleSystem3.minSize = 0.1;
                    particleSystem3.maxSize = 0.3;

                    // Life time of each particle (random between...
                    particleSystem3.minLifeTime = 0.1;


                    // Emission rate
                    particleSystem3.emitRate = 250;

                    // Blend mode : BLENDMODE_ONEONE, or BLENDMODE_STANDARD
                    particleSystem3.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

                    // Set the gravity of all particles
                    particleSystem3.gravity = new BABYLON.Vector3(0, -9.81, 0);

                    // Direction of each particle after it has been emitted
                    particleSystem3.direction1 = new BABYLON.Vector3(-7, 8, 3);
                    particleSystem3.direction2 = new BABYLON.Vector3(7, 8, -3);

                    // Angular speed, in radians
                    particleSystem3.minAngularSpeed = 0;
                    particleSystem3.maxAngularSpeed = Math.PI;

                    // Speed
                    particleSystem3.minEmitPower = 1;
                    particleSystem3.maxEmitPower = 3;
                    particleSystem3.updateSpeed = 0.005;

                    // Start the particle system


                    //Gravity

                    var gravityVector = new BABYLON.Vector3(0, -9.8, 0); //Здесь настраивать силу графитации

                    var physicsPlugin = new BABYLON.CannonJSPlugin();
                    scene.enablePhysics(gravityVector, physicsPlugin);
                    //scene.gravity = new BABYLON.Vector3(0, -9.8, 0);
                    sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, {
                        mass: 15,
                        friction: 0.9,
                        restitution: 0.9
                    }, scene);


                    Portal1.physicsImpostor = new BABYLON.PhysicsImpostor(Portal1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 1,
                        restitution: 0.1
                    }, scene);

                    track1.physicsImpostor = new BABYLON.PhysicsImpostor(track1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 1,
                        restitution: 0.1
                    }, scene);

                    Bridge1.physicsImpostor = new BABYLON.PhysicsImpostor(Bridge1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.8,
                        restitution: 0.5
                    }, scene);

                    platform1.physicsImpostor = new BABYLON.PhysicsImpostor(platform1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.01,
                        restitution: 0.5
                    }, scene);

                    road1.physicsImpostor = new BABYLON.PhysicsImpostor(road1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.01,
                        restitution: 0.5
                    }, scene);

                    Cube.physicsImpostor = new BABYLON.PhysicsImpostor(Cube, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.01,
                        restitution: 0.5
                    }, scene);

                    Portal2.physicsImpostor = new BABYLON.PhysicsImpostor(Portal2, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.01,
                        restitution: 0.1
                    }, scene);

                    Platformroad.physicsImpostor = new BABYLON.PhysicsImpostor(Platformroad, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        friction: 0.01,
                        restitution: 0.5
                    }, scene);


                    Cube1.physicsImpostor = new BABYLON.PhysicsImpostor(Cube1, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.3
                    }, scene);
                    //    Cube11.physicsImpostor = new BABYLON.PhysicsImpostor(Cube11, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 100, restitution: 0.3 }, scene);
                    Cube2.physicsImpostor = new BABYLON.PhysicsImpostor(Cube2, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.3
                    }, scene);
                    Cube3.physicsImpostor = new BABYLON.PhysicsImpostor(Cube3, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.3
                    }, scene);



                    Roadcorn.physicsImpostor = new BABYLON.PhysicsImpostor(Roadcorn, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.5
                    }, scene);

                    Final.physicsImpostor = new BABYLON.PhysicsImpostor(Final, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.5
                    }, scene);



                    Stone.physicsImpostor = new BABYLON.PhysicsImpostor(Stone, BABYLON.PhysicsImpostor.MeshImpostor, {
                        mass: 0,
                        restitution: 0.5
                    }, scene);


                    //Привязка клавиш

            var s = 40;

  var a=0.3;
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

   
    this.scene = scene;


    // Movement directions : top, bot, left, right
    var mvtDirection = [0,0,0,0];

function move() {

        var s = 13;

        if (mvtDirection[0] != 0) {
            sphere.applyImpulse(new BABYLON.Vector3(0,0,s), sphere.position);
		//	sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(0, 0, s/4));
		//	sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(0, 0, s/4, 0));
        }
        if (mvtDirection[1] != 0) {
            sphere.applyImpulse(new BABYLON.Vector3(0,0,-s), sphere.position);
		//	sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(0, 0, -s/4));
		//	sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(0, 0, -s/4, 0));
        }
        if (mvtDirection[2] != 0) {
            sphere.applyImpulse(new BABYLON.Vector3(-s,0,0), sphere.position);
		//	sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(-s/4, 0, 0));
		//	sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(-s/4, 0, 0, 0));
        }
        if (mvtDirection[3] != 0) {
            sphere.applyImpulse(new BABYLON.Vector3(s,0,0), sphere.position);
		//	sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(s/4, 0, 0));
			//sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(s/4, 0, 0, 0));
        }
   //   body.body.linearVelocity.scaleEqual(0.92);
   //   body.body.angularVelocity.scaleEqual(0);
	  
	 // sphere.physicsImpostor.linearVelocity.scaleEqual(0.92);
	//  sphere.physicsImpostor.setAngularVelocity(new BABYLON.Quaternion(0, 0, 0, 100));
	  
	//	  sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(1, 0, 1));
	 // sphere.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(1, 0, 1));
	  
    }






  window.onkeydown = function(event) {  
                        if (event.keyCode == 65) {
                           // this._chooseDirection(2, 0);
							mvtDirection[0]=1;
                        }
                        if (event.keyCode == 68) {
                           // this._chooseDirection(3, 1); //право
							mvtDirection[1]=1;
                        }
                        if (event.keyCode == 87) {
                           // this._chooseDirection(0, 1); //вверх
							mvtDirection[3]=1;
                        }
                        if (event.keyCode == 83) {
                           // this._chooseDirection(1, 1); //низ   
							mvtDirection[2]=1;
}            
move();
  }
 
    window.onkeyup = function(event) {  
                        if (event.keyCode == 65) {
							mvtDirection[0]=0;
                        }
                        if (event.keyCode == 68) {
							mvtDirection[1]=0;
                        }
                        if (event.keyCode == 87) {
							mvtDirection[3]=0;
                        }
                        if (event.keyCode == 83) {
							mvtDirection[2]=0;
}            
move();
  }
  
  
  
  
  
  
  
  
  
  
  
  
  
  

                    // Skybox


                    var skybox = BABYLON.Mesh.CreateBox("skyBox", 100.0, scene);
                    var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
                    skyboxMaterial.backFaceCulling = false;
                    skyboxMaterial.disableLighting = false;
                    skybox.material = skyboxMaterial;
                    skybox.infiniteDistance = true;
                    skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
                    skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
                    skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("sky/skybox", scene);
                    skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;




                    var camera = scene.activeCamera;
                    camera.attachControl(canvas, false);
                    //sphere.position.x=scene.getMeshByName('Cube1').position.x+1;
                    //sphere.position.y=scene.getMeshByName('Cube1').position.y+6;
                    //sphere.position.z=scene.getMeshByName('Cube1').position.z;
                    //sphere.position.x=scene.getMeshByName('Portal2').position.x+1;
                    //sphere.position.y=scene.getMeshByName('Portal2').position.y+6;
                    //sphere.position.z=scene.getMeshByName('Portal2').position.z-1; //Финальная ПОЗИЦИЯ
                    //sphere.position.z=scene.getMeshByName('Portal2').position.z-1;


                    //scene.getMeshByName('Cube2').disabled=true;
                    //  scene.getMeshByName('Cube3').disabled=true;
                    // scene.getMeshByName('Cube2').visibility=false;
                    //  scene.getMeshByName('Cube3').visibility=false;




                    //scene.getMeshByName('Cube1').position.y=scene.getMeshByName('Cube1').position.y+4;
                    //scene.getMeshByName('Cube2').position.y=scene.getMeshByName('Cube2').position.y+4;
                    //scene.getMeshByName('Cube3').position.y=scene.getMeshByName('Cube3').position.y+4;


                    engine.runRenderLoop(function() { //LOOOOOOOOOOOOOOOOP
                        scene.render();
                        var spherepositonxnow = sphere.position.x.toFixed(3);
                        var spherepositonznow = sphere.position.z.toFixed(3);
                        var spherepositonynow = sphere.position.y.toFixed(3);




                        if (sphere.intersectsMesh(Portal1, false) & checkport == 0) {

                            Portalzero = 1;
                            var portal = new Audio('Misc_StartLevel.wav');
                            portal.play(); //начало
                            var lightning = new Audio('Misc_Lightning.wav');
                            lightning.play(); //Появление
                            checkport = 1;
                        }
                        //  console.log(spherepositonxnow);
                        //  console.log(spherepositonznow);//Мониторинг позиции шара
                        //   console.log(spherepositonynow);


                        /*  scene.getMeshByName('Cube1').position.z=cubefixer1;
                          scene.getMeshByName('Cube2').position.z=cubefixer2;
                          scene.getMeshByName('Cube3').position.z=cubefixer3;
                          
                          scene.getMeshByName('Cube1').rotate.z=cuberotatefixer1z;
                          scene.getMeshByName('Cube1').rotate.x=cuberotatefixer1x;
                          scene.getMeshByName('Cube1').rotate.y=cuberotatefixer1y;

                          scene.getMeshByName('Cube2').rotate.z=cuberotatefixer2z;
                          scene.getMeshByName('Cube2').rotate.x=cuberotatefixer2x;
                          scene.getMeshByName('Cube2').rotate.y=cuberotatefixer2y;

                          scene.getMeshByName('Cube3').rotate.z=cuberotatefixer3z;
                          scene.getMeshByName('Cube3').rotate.x=cuberotatefixer3x;
                          scene.getMeshByName('Cube3').rotate.y=cuberotatefixer3y; */

                        camera.position.z = sphere.position.z;
                        camera.position.x = sphere.position.x - 6;

                        if (sphere.intersectsMesh(track1, false)) {
                            //Звук качение по камню var RollWoodStone = new Audio('Roll_Wood_Stone.wav');
                            //RollWoodStone.play();
                        }
                        if (sphere.intersectsMesh(Bridge1, false)) {
                            if (Music1 == 0) {
                                var Bridge = new Audio('Music_Theme_2_1.wav'); //Музыка на мосте
                                Bridge.play();
                                Music1 = 1;
                            }

                        }

                        if (sphere.intersectsMesh(open2, false)) {
                            if (open11 == 0) {
                                sphereopen2.physicsImpostor = new BABYLON.PhysicsImpostor(sphereopen2, BABYLON.PhysicsImpostor.SphereImpostor, {
                                    mass: 1,
                                    restitution: 0.9
                                }, scene);


                                particleSystem2.start();
                                sphereopen2.visibility = false;
                                Cube2.position.y = 20;
                                Cube1.position.y = 20;
                                watersound1.play();
                                watersound2.play();

                                function Stopwat() {


                                    particleSystem2.stop(); //Остановка
                                }

                                setTimeout(Stopwat, 2000);
                                open11 = 1;

                            }

                        }

                        if (sphere.intersectsMesh(open1, false)) {
                            if (open22 == 0) {
                                sphereopen.physicsImpostor = new BABYLON.PhysicsImpostor(sphereopen, BABYLON.PhysicsImpostor.SphereImpostor, {
                                    mass: 1,
                                    restitution: 0.9
                                }, scene);

                                Cube3.position.y = 20;
                                particleSystem3.start();
                                sphereopen.visibility = false;
                                watersound1.play();
                                watersound2.play();

                                function Stopwat2() {


                                    particleSystem3.stop(); //Остановка
                                }

                                setTimeout(Stopwat2, 2000);

                                open22 = 1;

                            }

                        }

                        if (sphere.intersectsMesh(Cube, false)) {
                            if (Music2 == 0) {
                                var Cubemus = new Audio('Music_Theme_2_2.wav'); //Музыка в центре
                                Cubemus.play();
                                Music2 = 1;
                            }

                        }

                        if (sphere.intersectsMesh(Final, false)) {
                            if (Music3 == 0) {
                                var Finalmus = new Audio('Music_Theme_2_3.wav'); //Музыка в конце
                                Finalmus.play();
                                Music3 = 1;
                            }

                        }

                        if (sphere.intersectsMesh(ground, false) & Portalzero == 1) //Проверка на пересечение
                        {
                            lifes--;

                            var Fall = new Audio('Misc_Fall.wav');
                            Fall.play();
                            var lightning = new Audio('Misc_Lightning.wav');
                            lightning.play();

                            sphere.position.x = scene.getMeshByName("Sphere").position.x;
                            sphere.position.y = scene.getMeshByName("Sphere").position.y;
                            sphere.position.z = scene.getMeshByName("Sphere").position.z;
                            particleSystem1.start();

                            function Stop() {


                                particleSystem1.stop(); //Остановка
                            }

                            setTimeout(Stop, 1000);
                        }




                        if (sphere.position.x.toFixed(2) < -10 && sphere.position.x.toFixed(2) > -10.3 && sphere.material !== materialSpherewood) {
                            if (sphere.position.y.toFixed(2) == 6.5) {


                                sphere.material = materialSpherewood;
                                var Trafo = new Audio('Misc_Trafo.wav'); //П
                                Trafo.play();




                            }
                        }

                        if (sphere.intersectsMesh(Stone, false) && sphere.material !== materialSpherestone) //Превращение в камень
                        {

                            sphere.material = materialSpherestone;
                            var Trafo = new Audio('Misc_Trafo.wav');
                            Trafo.play();

                        }

                        if (sphere.intersectsMesh(Portal2, false)) //Превращение в камень
                        {

                            if (check1 == 0) {
                                var Check = new Audio('Misc_Checkpoint.wav');
                                Check.play();
                                particleSystem1.start();

                                function Stopcheck() {


                                    particleSystem1.stop(); //Остановка
                                    Portalzero = 0;
                                    Portalfisrt = 1;
                                }

                                setTimeout(Stopcheck, 1000);
                            }
                            check1 = 1;
                        }

                        if (sphere.intersectsMesh(ground, false) & Portalfisrt == 1) //Проверка на пересечение
                        {
                            lifes--;
                            document.getElementById("header").innerHTML = "Lifes:" + lifes;
                            var Fall = new Audio('Misc_Fall.wav');
                            Fall.play();
                            var lightning = new Audio('Misc_Lightning.wav');
                            lightning.play();

                            sphere.position.x = scene.getMeshByName("Portal2").position.x + 0.6;
                            sphere.position.y = scene.getMeshByName("Portal2").position.y + 1;
                            sphere.position.z = scene.getMeshByName("Portal2").position.z - 1;
                            particleSystem1.start();

                            function Stop() {


                                particleSystem1.stop(); //Остановка
                            }

                            setTimeout(Stop, 1000);
                        }

                        if (sphere.intersectsMesh(life, false)) {
                            lifes++;
                            //Получение жизни
                            life.visibility = false;

                            if (life1 == 0) {
                                var Bulb1 = new Audio('Extra_Life_Blob.wav');
                                Bulb1.play();

                                var Bulb2 = new Audio('Misc_extraball.wav');
                                Bulb2.play();


                                particleSystem1.start();
                                life = 1;

                                function myFunction() {


                                    particleSystem1.stop(); //Остановка
                                }

                                setTimeout(myFunction, 1000);



                            }

                        }
                        if (lifes < 1 & check2 == 0) {
                            document.getElementById('over').style.display = 'block';
                            document.getElementById('firstball').style.display = 'none';
                            document.getElementById('secondball').style.display = 'none';
                            document.getElementById('thirdball').style.display = 'none';
                            document.getElementById('fourthball').style.display = 'none';
                            document.getElementById('fifthball').style.display = 'none';
                            document.getElementById('Triangle').style.display = 'none';
                            document.getElementById('button-right').style.display = 'none';
                            check2 = 1;
                            sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, {
                                mass: 0,
                                restitution: 0.9
                            }, scene);
                        }

                        if (lifes == 1) {
                            document.getElementById('firstball').style.display = 'inline-block';
                            document.getElementById('secondball').style.display = 'none';
                            document.getElementById('thirdball').style.display = 'none';
                            document.getElementById('fourthball').style.display = 'none';
                            document.getElementById('fifthball').style.display = 'none';
                        }
                        if (lifes == 2) {
                            document.getElementById('firstball').style.display = 'inline-block';
                            document.getElementById('secondball').style.display = 'inline-block';
                            document.getElementById('thirdball').style.display = 'none';
                            document.getElementById('fourthball').style.display = 'none';
                            document.getElementById('fifthball').style.display = 'none';
                        }
                        if (lifes == 3) {
                            document.getElementById('firstball').style.display = 'inline-block';
                            document.getElementById('secondball').style.display = 'inline-block';
                            document.getElementById('thirdball').style.display = 'inline-block';
                            document.getElementById('fourthball').style.display = 'none';
                            document.getElementById('fifthball').style.display = 'none';
                        }
                        if (lifes == 4) {
                            document.getElementById('firstball').style.display = 'inline-block';
                            document.getElementById('secondball').style.display = 'inline-block';
                            document.getElementById('thirdball').style.display = 'inline-block';
                            document.getElementById('fourthball').style.display = 'inline-block';
                            document.getElementById('fifthball').style.display = 'none';
                        }
                        if (lifes == 5) {
                            document.getElementById('firstball').style.display = 'inline-block';
                            document.getElementById('secondball').style.display = 'inline-block';
                            document.getElementById('thirdball').style.display = 'inline-block';
                            document.getElementById('fourthball').style.display = 'inline-block';
                            document.getElementById('fifthball').style.display = 'inline-block';
                        }



                        //   console.log( sphere.position.x.toFixed(2)); 
                        //   console.log( sphere.position.y.toFixed(2)); 




                    });
                });
            }, function(progress) {
                // To do: give progress feedback to user
            });




            // Resize
            window.addEventListener("resize", function() {
                engine.resize();
            });
        </script>
    </body>

</html>